language: shell

os:
  - linux

# Setting sudo to false opts in to Travis-CI container-based builds.
sudo: false

# The apt packages below are needed but can no longer be installed with
# sudo apt-get.
addons:
  apt:
    packages:
      - gfortran
      - cmake
      - libgomp1
env:
  global:
    # Intel Parallel Studio
    - secure: "QqPKeHzkLQTI2snytnWlKmeRVMQe9fAn382ehnYDgB8IxLYkNJ6wieAOVEESdqvIF2tJ5ciuwXVFReYTuS0JIk9poTljpXtYW9AQ5u6OvAvT2MbYhz2vuIFnMSiJMs+jX7q4+jipu+If11yUezKVp0/qFJV0SzgTp2TYtvRFi9JuiURWz5NxLvy0S9g5jRJljbiahi8Fgj9Rf/ZvZ0rdwCbYiwdkeqnL50f1mp9uBdpA1M6D9sgND1uT1aGwY1/AYpJ42cOtJ2e1wSdtmkfBN9NbkRODdC8tXKIKPtu/ID12aKiZrIuVPQdL6ZtesjxwIXvpON8vWb1SrkGwQVzXlszPuzwugoZBQSUsSzh4CAKyJadn3DGlOZJgm+jz7eLKyHmhtQwimN2ll2hTJNC8D6SOOm1QaCYnhJV9bfLn8a9LnZnLIbKoCqrtq+rmZBA9iFSCrO5kyTtsA/Nt7EUGWJPGM9i4im/Kc2bcRyZUzssCQg+mbu4TdZO8UVS4gOTqkOnll43iML5MX278go7MRihiYCRU4YXKCkH0auf6mmLDfnCsFqKQheOBMwVN0WfA2sT9U2ycoP5OzkmqvNUlVIZJDVqR6E/55PQ/2oTjRGgl/Vp5UwjjsHp7db8rqHERXI3TGzK6tzsoFO9U3dI0bC1bWPJyRqM7q0SbiozBWmc="

matrix:
  # Don't wait for allowed failures - do we really need this? TODO
  fast_finish: true

  include:
    # - os: osx
      
    # - os: linux

    # - os: windows

    - os: linux
      sudo: false
      env: COMPONENTS=ifort

before_install:
  # Install stuff specifically for MacOS
  - if [ $TRAVIS_OS_NAME = osx ]; then brew update; rm '/usr/local/include/c++'; brew install gcc; fi
  # Install stuff specifically for Windows
  - if [ $TRAVIS_OS_NAME = windows ]; then choco install make; fi
  - chmod 777 ./install-icc.sh
  - ./install-icc.sh --components "${COMPONENTS}"
  - source ~/.bashrc

install:

before_script:

script:
  - source ~/.bashrc
  - cd FortranCode
  - mkdir build
  - cd build
  - cmake .. -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release -Ddoopenmp=OFF
  - make -j
  - while sleep 540 ; do echo "=========== tests are taking more than 9m - pinging travis =========="; done &
  - PING_PID=$!
  # - ctest --output-on-failure
  - ctest -L fast --output-on-failure
  # - ctest -L "(fast|medium)" --output-on-failure
  - kill $PING_PID

after_script:
  - '[[ ! -z "${INTEL_INSTALL_PATH}" ]] && uninstall_intel_software'

after_success:

